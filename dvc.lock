schema: '2.0'
stages:
  download:
    cmd: python3 main.py --download-data
    deps:
    - path: src/protx/data/download.py
      hash: md5
      md5: 0882b748847dee0423b4f1f16d8490b9
      size: 1024
    outs:
    - path: pipeline_output/data/raw/uniref50.fasta.gz
      hash: md5
      md5: b39e4fdf12810e78e2befdf7460f255b
      size: 92924866
  extract:
    cmd: python3 main.py --extract-data
    deps:
    - path: pipeline_output/data/raw/uniref50.fasta.gz
      hash: md5
      md5: b39e4fdf12810e78e2befdf7460f255b
      size: 92924866
    - path: src/protx/data/extract.py
      hash: md5
      md5: 714aa670b0c3194120bef6cc18cdd3f1
      size: 1764
    outs:
    - path: pipeline_output/data/raw/uniref50.fasta
      hash: md5
      md5: acd7214694350f9a0c097122b777c978
      size: 286365155
  preprocess:
    cmd: python3 main.py --preprocess-data
    deps:
    - path: pipeline_output/data/raw/uniref50.fasta
      hash: md5
      md5: acd7214694350f9a0c097122b777c978
      size: 286365155
    - path: src/data/preprocess.py
      hash: md5
      md5: 69e0e61bee2114bbe3a0b837c636499a
      size: 6703
    params:
      src/data/params.yaml:
        max_seqs_number: 202
        max_sequence_length: 512
        min_sequence_length: 20
    outs:
    - path: pipeline_output/data/processed/uniref50_processed.fasta
      hash: md5
      md5: 7099fbb631785692da131ae0a98ed059
      size: 60788
  split:
    cmd: python3 main.py --split-data
    deps:
    - path: pipeline_output/data/processed/uniref50_filtered.fasta
      hash: md5
      md5: 7488763186eb49222e622344670a3b69
      size: 15904
    - path: src/protx/data/preprocess.py
      hash: md5
      md5: d3ece3f667f2a2dd0f968dd2635902a0
      size: 10479
    params:
      src/protx/data/params.yaml:
        val_ratio: 0.1
    outs:
    - path: pipeline_output/data/processed/dataset_info.txt
      hash: md5
      md5: 57e851068dc7a4224c8ba7f1ac060847
      size: 323
    - path: pipeline_output/data/processed/train.fasta
      hash: md5
      md5: d3114b24a98457eb269891fcc474e843
      size: 14609
    - path: pipeline_output/data/processed/val.fasta
      hash: md5
      md5: a5ab862149ad0d734db991a819c47843
      size: 1295
  tokenize:
    cmd: python3 main.py --tokenize-data
    deps:
    - path: pipeline_output/data/processed/train.fasta
      hash: md5
      md5: d3114b24a98457eb269891fcc474e843
      size: 14609
    - path: pipeline_output/data/processed/val.fasta
      hash: md5
      md5: a5ab862149ad0d734db991a819c47843
      size: 1295
    - path: src/protx/data/preprocess.py
      hash: md5
      md5: d3ece3f667f2a2dd0f968dd2635902a0
      size: 10479
    params:
      src/protx/data/params.yaml:
        batch_size: 32
    outs:
    - path: pipeline_output/data/processed/tokenized/train.h5
      hash: md5
      md5: 67a588690f8650512f79b23a83f91714
      size: 382880
    - path: pipeline_output/data/processed/tokenized/val.h5
      hash: md5
      md5: 23d6698d8961b260cffefbfc2451dee0
      size: 32192
  filter:
    cmd: python3 main.py --filter-data
    deps:
    - path: pipeline_output/data/raw/uniref50.fasta
      hash: md5
      md5: acd7214694350f9a0c097122b777c978
      size: 286365155
    - path: src/protx/data/preprocess.py
      hash: md5
      md5: d3ece3f667f2a2dd0f968dd2635902a0
      size: 10479
    params:
      src/protx/data/params.yaml:
        max_seq_len: 512
        max_seqs_num: 50
        min_seq_len: 20
    outs:
    - path: pipeline_output/data/processed/uniref50_filtered.fasta
      hash: md5
      md5: 7488763186eb49222e622344670a3b69
      size: 15904
  teacher_embeddings:
    cmd: python3 main.py --generate-teacher-embeddings
    deps:
    - path: pipeline_output/data/processed/tokenized/train.h5
      hash: md5
      md5: 67a588690f8650512f79b23a83f91714
      size: 382880
    - path: pipeline_output/data/processed/tokenized/val.h5
      hash: md5
      md5: 23d6698d8961b260cffefbfc2451dee0
      size: 32192
    - path: src/protx/distillation/teacher_embed.py
      hash: md5
      md5: ec563bebe157f4886fe7980706e029af
      size: 6671
    - path: src/protx/models/teacher.py
      hash: md5
      md5: d5ff4110db6d1501f3deb215382fd642
      size: 3949
    params:
      src/protx/data/params.yaml:
        batch_size: 32
    outs:
    - path: pipeline_output/data/processed/teacher_embeddings/train.h5
      hash: md5
      md5: 46c6b4d473a42a4753c03bc5027954f4
      size: 89796608
    - path: pipeline_output/data/processed/teacher_embeddings/val.h5
      hash: md5
      md5: e6578f11952e091cc28b89d65d757fd0
      size: 6111312
